<!-- Front page HTML -->
<!DOCTYPE html>
<html lang="en">
    <head>
        <title> Flask App </title>
        <link rel = "stylesheet" type= "text/css" href = " {{ url_for('static', filename = 'style.css') }}">
    </head>
    <body>
    <!-- This code connects WebsocketsIO to the index.html file, so it can update the
     display in real-time. -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
        <script>
        var socket = io.connect('http://' + document.domain + ':' + location.port);

        // Waits to receive 'update_data' from socket's emit function in app.py
        // Once it receives it, it runs the function.
        // The parseFloat and toFixed(2) ensure that the data read is a float up to 2 decimal places.
        socket.on('update_data', function(data) {
            
            // Does nothing as of now

            console.log("Received data", data);
        });
        </script>

        <div class = "title">
            <img src="https://sites.tufts.edu/racing/files/2020/04/cropped-newlogo-2.png"
            width="337.5" length="750"/>
        </div>
        
        
        <h1>Hello World</h1>
        <!-- Write up-to-date sensor readings here!!! -->
         <style>
            table, th, td {
            border: 1px solid black; border-collapse: collapse;
            }
        </style>
        <table> 
            <tr>
                <td>Name</td>
                <td>Value</td>
            </tr>
            <tr>
                <td>{{ data[0].name }}</td>
                <td>{{ data[0].data }} </td>
            </tr>
            <tr>
                <td>{{ data[1].name }}</td>
                <td>{{ data[1].data }}</td>
            </tr>
            <tr>
                <td>{{ data[2].name }}</td>
                <td>{{ data[2].data }}</td> 
            </tr>
        </table>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
        <canvas id="myChart" style="width:100%;max-width:700px"></canvas>
        <script>   
            function addDataPoint(chart)
            {
                fetch('/readings')
                    .then(response => response.json())
                    .then(data => console.log(data))
                    .catch(error => console.error('Error:', error));
                // chart.data.datasets[0].data.push(newDataPoint);
                // chart.update();
            }
        
            const xValues = [{{ data[0].timestamp }}, {{ data[1].timestamp }}, {{ data[2].timestamp }}];
            const yValues = [{{ data[0].data}}, {{ data[1].data }}, {{ data[2].data }}];
            const myChart = new Chart("myChart", {
                type: "line",
                data: {
                    labels: xValues,
                    datasets: [{
                        backgroundColor:"rgba(255,255,255,1.0)",
                        borderColor: "rgba(0,0,255,0.1)",
                        data: yValues
                    }]
            }   ,
            });

            setInterval(() => {
                addDataPoint(myChart);
            }, 3000);
        </script>
        
    </body>
</html>